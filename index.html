<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>T7's Website</title>
    <link rel="stylesheet" href="/assets/data/styles.css">

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/data/site.webmanifest">

    <style>
      body {
        text-align: center;
        padding: 80px 20px;
        max-width: 800px;
        user-select: none;
        overflow: hidden;
      }
      #login-link, #credits-link, #delete-data {
        position: fixed;
        top: 10px;
        right: 10px;
        font-size: 18px;
        margin-top: 30px;
      }
      #credits-link { top: 40px; }
      #delete-data {
        top: 70px;
        color: #dc143c;
        cursor: pointer;
      }
      #delete-data:hover {
        color: #8b0000;
        text-decoration: underline;
      }
      #splash-text {
        font-size: 18px;
        color: #ff0;
      }
      #splash-link {
        display: inline;
        margin-top: 0px;
        font-size: 18px;
      }
      #news-section {
        background-color: rgba(255, 255, 255, 0.125);
        color: #fff;
        font-family: Arial, sans-serif;
        padding: 10px 0;
        font-size: 16px;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1;
        overflow: hidden;
        white-space: nowrap;
      }
      #news-ticker {
        display: inline-block;
        padding-left: 100%;
        animation: scroll-left 10s linear infinite;
      }
      #news-ticker:hover {
        animation-play-state: paused;
        cursor: pointer;
      }
      @keyframes scroll-left {
        0% { transform: translateX(0); }
        100% { transform: translateX(-100%); }
      }
      #online, #visits, #version {
        position: fixed;
        color: #555;
        font-size: 18px;
        bottom: 10px;
        left: 10px;
      }
      #visits, #version { bottom: 40px; }
      #version {
        left: unset;
        right: 10px;
      }
      #screensaver-toggle, #music-player {
        position: fixed;
        top: 10px;
        left: 10px;
        cursor: pointer;
        margin-top: 40px;
      }
      #music-player {
        top: 40px;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }
      #feedback-link {
        position: fixed;
        bottom: 10px;
        right: 10px;
        font-size: 18px;
        margin-top: 30px;
      }
      .current-account {
        position: fixed;
        bottom: 70px;
        left: 10px;
        font-size: 18px;
      }
      .current-username { color: #3FCF8E; }
      #ad {
        position: fixed;
        bottom: 70px;
        right: -300px;
        text-align: right;
        animation: spawn-ad 1s ease-in-out forwards;
        animation-delay: 1s;
        z-index: 1;
      }
      @keyframes spawn-ad {
        from { right: -300px; }
        to { right: 0; }
      }
      @keyframes despawn-ad {
        from { right: 0; }
        to { right: -300px; }
      }
      #close-ad {
        background: #dc143c;
        color: white;
        border: none;
        padding: 2px 6px;
        cursor: pointer;
        font-size: 12px;
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0.5;
      }
      #close-ad:hover {
        background: #8b0000;
      }
      #black-hole {
        position: absolute;
        bottom: 70px;
        right: -300px;
        cursor: grab;
        width: 128px;
        animation: spawn-ad 1s ease-in-out forwards;
        animation-delay: 1s;
      }
      .spacer { height: 1000px; }
    </style>

    <script src="/assets/data/mobile.js"></script>
    <script src="/assets/data/time.js"></script>
    <script src="/assets/data/firebase-init.js"></script>
    <script src="/assets/data/black-hole.js" defer></script>
    <script src="/assets/data/account.js" defer></script>
    <script src="/assets/data/delete-data.js" defer></script>
    <script src="/assets/data/music-player.js" defer></script>
    <script src="/assets/data/redirect.js" defer></script>
    <script src="/assets/data/screensaver.js" defer></script>
    <script src="/assets/data/special-text.js" defer></script>
    <script src="/assets/data/splash.js" defer></script>
    <script src="/assets/data/version.js" defer></script>
  </head>
  <body>
    <h1>Welcome to <span class="special-text">T7's Website</span>!</h1>

    <img src="/assets/images/objects/black-hole.png" id="black-hole" draggable="false">

    <div id="splash-text">loading splash text...</div>

    <div id="news-section">
      <div id="news-ticker">loading news...</div>
    </div>

    <br>
    <input type="text" id="id-input" style="margin-top: 20px;" onkeydown="if (event.key==='Enter') redirectToKeyword();" placeholder="Enter ID">
    <button onclick="redirectToKeyword()">Go</button>

    <input type="checkbox" id="screensaver-toggle" title="Screensaver" checked>

    <audio id="background-music" src="/assets/audio/greenroom.mp3" autoplay loop preload="auto"></audio>
    <button id="music-player" data-song-title="&quot;Deltarune OST - Welcome to the Green Room&quot; by Toby Fox" title="Play Background Music"></button>

    <br>
    <p>
      A fun ARG project created on April 28th 2025 using HTML, CSS and JavaScript.
      <br>
      <span style="color: #dc143c">WARNING</span>: this website may contain flashing lights, loud sounds, blood and disturbing imagery. <span style="color: #dc143c">Proceed with caution.</span>
      <br>
      <span class="special-text">Good Luck &amp; Have Fun&excl;</span>
      <br>
      This website is in development and will recieve regular updates.
      <br>
      Have a question? Contact me on Discord: <a href="//discordapp.com/users/878845118369636433/" draggable="false" target="_blank">@real_t7</a>
    </p>
    <a href="//linktr.ee/TheReal_T7/" draggable="false" target="_blank">→ other contacts</a>
    <br>
    <a href="/html/games/" draggable="false">→ minigames</a>
    <br>

    <div id="ad">
      <button id="close-ad" onclick="document.getElementById('ad').style.animation = 'despawn-ad 1s ease-in-out forwards';">✕</button>
      <a href="https://www.watching-grass-grow.com/" draggable="false" target="_blank"><img style="border: 2px solid green; width: 150px;" draggable="false" src="https://www.watching-grass-grow.com/watching-grass-grow.gif" alt="watching grass grow" title="watching grass grow"></a>
    </div>

    <div class="current-account">welcome, <span class="current-username">stranger</span>!</div>
    <a href="/html/login/" id="login-link" draggable="false">→ login</a>
    <a href="/html/credits/" id="credits-link" draggable="false">→ credits</a>
    <a href="/html/feedback/" id="feedback-link" draggable="false">→ send a feedback</a>
    <div id="delete-data" onclick="deleteAllData()">→ delete data</div>
    <div id="visits">loading visits...</div>
    <div id="online">loading online count...</div>
    <div id="version">loading version...</div>

    <script>
      document.addEventListener("firebase-ready", () => {
        const dbRef = db.ref.bind(db);

        const newsTicker = document.getElementById("news-ticker");
        const onlineDiv = document.getElementById("online");
        const visitDiv = document.getElementById("visits");

        // update news ticker
        dbRef("news").on("value", snap => {
          const val = snap.val();
          newsTicker.innerHTML = val
            ? `<strong>Latest News:</strong> "${val}"`
            : "nothing here at the moment";
        });

        // track online users
        const onlineUsersRef = dbRef("online/main");
        const myConnectionRef = dbRef(".info/connected");

        myConnectionRef.on("value", snap => {
          if (snap.val()) {
            const userRef = onlineUsersRef.push();
            userRef.set(true);
            userRef.onDisconnect().remove();
          }
        });

        // display online count
        onlineUsersRef.on("value", snap => {
          const count = snap.numChildren();
          onlineDiv.textContent = `${count} online user${count === 1 ? "" : "s"}`;
        });

        // visit system
        const hasVisited = localStorage.getItem("visited");

        if (!hasVisited) {
          dbRef("visits").transaction(
            curr => (curr || 0) + 1,
            (error, committed, snap) => {
              if (committed && snap.exists()) {
                visitDiv.textContent = `you are visitor #${snap.val()}`;
                localStorage.setItem("visited", "true");
                document.dispatchEvent(new Event("visit-ready"));
              }
            }
          );
        } else {
          dbRef("visits").once("value").then(snap => {
            if (snap.exists()) {
              visitDiv.textContent = `${snap.val()} visitor${snap.val() === 1 ? "" : "s"}`;
            } else {
              visitDiv.textContent = "no visitors yet";
            }
            document.dispatchEvent(new Event("visit-ready"));
          });
        }
      });
    </script>

    <script>
      console.log("Hello, World!");
    </script>
  </body>
</html>